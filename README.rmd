---
title: 'Readme'
author: 'Olamide Adu'
output: 
  md_document: 
    variant: markdown_github
---

# Sverige LantbruksUniversitet (SLU) Permanent Forest Experiments

![](https://i0.wp.com/odlandestadsbasarer.se/wp-content/uploads/2017/09/SLU-2.jpg?ssl=1)

# Brief Introduction

This is an analysis done as part of the **Sustainable Forestry in Southern Sweden** course in the Euroforester program at the SLU campus at the south of Sweden in [Alnarp](https://www.slu.se/en/departments/southern-swedish-forest-research-centre/).

The data used for this analysis were provided mainly by the research centre at Tonnersjoheden and have been [uploaded here](https://github.com/xrander/SLU-Plantation-Experimentation/tree/master/Data).

I will be taking us through the analysis journey. Terms relating to forestry will be explained, while syntax of R used won't be explained. I will also be taking you through the analysis.

**Data Exploration** The package used is the doBy library doBy, dplyr, lattice, ggplot, TukeyC and so on To install the package run the command like this `install.packages('package name')` as an example `install.packages('dplyr')`.

====NB: For most part of the analysis base r packages will be used====

```{r results='hide', message=FALSE, warning=FALSE}
library(doBy)
library(dplyr)
library(lattice)
library(ggplot2)
library(car)
library(data.table)
library(TukeyC)
```

------------------------------------------------------------------------

# Clone Performance Test - Exp I

The first experiment will be a clone performance experiment. The data used is the 'popdata' which is accessible [here](https://raw.githubusercontent.com/xrander/SLU-Plantation-Experimentation/master/Data/popdata.txt). This analysis will seek to answer the question: - Is the treatment having an influence - Which clone is performing best

*Importing the data*

```{r eval= TRUE}
pop <- read.table('https://raw.githubusercontent.com/xrander/SLU-Plantation-Experimentation/master/Data/Lab1/popdata.txt', header = T)
head(pop)
```

**Data description**

-   block: experimental block

-   cutw: cultivar weight

-   height: height of the plant

-   dia = diameter

-   clone: clone class

-   fert: Fertilized or not(1 = fertilized and 3 = control)

We can create a column now and assign the names to the different values.

*Creating a column to give name to the values of the fert*

```{r}
pop$fert_value <- ifelse(pop$fert==1, 'fertilized', 'control')
head(pop)
```

## Questions

    -   Plot the height diameter relationship of different treatment of seedlings

    - estimate the index of slenderness of the stand

    -   Plot the performance of the seedlings and state which of the clones performing the best

## Height diameter relationship of the control and fertilized seedlings

The first step of the analysis is visualize the effect of treatment on diameter and height

```{r}
plot(pop$dia, pop$height,
     text(x=01.5,
          y=450,
          labels = "Growth rate of fertilized and unfertilized seedlings",
          col = "red",
          cex = 0.7),
     xlim = c(0,5.5),
     ylim = c(0, 600),
     xlab = 'diameter(mm)',
     ylab = 'Height(mm)',
     main = "Height vs Diameter",
     pch = c(16,17),
     col = c('red', 'blue'))
legend("topleft",
       legend = c("Control","Fertilized"),
       pch= c(16,17),
       col = c('red','blue'))

```

## Index of Slenderness

The height diameter ratio or index of slenderness is an important measure as it can be used to evaluate a tree stability. To read more on height diameter relationship click [here](<https://www.mdpi.com/1999-4907/10/1/70/htm#>:\~:text=Height%2Dto%2Ddiameter%20ratio%20(,of%20tree%20and%20stand%20stability.). The formula for HDr is given below

$$HD_r = height/diameter$$ Where $$HD_r = height diameter ratio$$

```{r}
pop$hd <- pop$height/pop$dia

```

Given the data we can estimate the average height and diameter for the clones and treatments

```{r}
pop_summary <- summaryBy(height + dia ~ fert + clone, data = pop, FUN=mean)
head(pop_summary)
```

The mean height to diameter of the different treatment as given with the formula above can be estimated.

```{r}
pop_summary$h_d <- pop_summary$height.mean/pop_summary$dia.mean

names(pop_summary)[5] <- 'height_dia_ratio'

barplot(pop_summary$height_dia_ratio,
        names.arg = pop_summary$clone,
        col = pop_summary$fert,
        xlab = substitute(paste(bold('clone'))),
        ylab = substitute(paste(bold('height_diameter_ratio'))),
        main = 'Seedling Clone Performance',
        legend = TRUE)
legend('topright',
       legend = c(substitute(paste(bold('fertilized'))),  substitute(paste(bold('control')))),
       col = c('black', 'green'),
       pch = 18)
```

It is evident that the fertilized are performing than the control, with the B clone class being the highest performing either fertilized or not.

------------------------------------------------------------------------

------------------------------------------------------------------------


------------------------------------------------------------------------

# Thinning Experiment of Birch and Scotch Pine - Exp IV

Data used in this experiment are from different precommercial thinning treatments (PCT) which are thereafter simulated in Heureka (Swedish support decision system). The stand development was simulated with some thinning operations included. Data provided is from every 5 year period.

**Data Description**

-   age: the age of the stand

-   site: the site number (1 for spruce and 6 birch)

-   stdens: stem density (st/ha)

-   ba: basal area (m\^2/ha)

-   spruce_dgv: quadratic mean dbh for spruce in cm

-   birch_dgv: quadratic mean dbh for birch in cm

-   stand_vol: standing volume

-   harv_vol: harvested volume

-   mor_vol: mortality volume in m\^3 at the age

**importing data**

```{r}
lab4mai <- read.table('https://raw.githubusercontent.com/xrander/SLU-Plantation-Experimentation/master/Data/Lab%204/lab4mai%20(2).txt',
           header = T, sep = '\t',
           na.strings = 'NA', dec = '.',
           strip.white = T)
```

We can inspect the data structure to investigate if the variables are in the data type we want.

```{r}
str(lab4mai)
```

This is important to do whenever we import data as some integer may be in character format.

## Questions

For this data we will do some exploration, we then find:

    -   total volume

    -   total yield,

    -   CAI and MAI

    -   correct the figure with thinning age

    -   find how many thinnings were done for both species

    -   decide if thinnings done were heavy or not.

## Total Volume Estimation

Given the data we have, we can get the total volume produce by adding all the volumes: $$tot_{vol} = stand_{vol} + harv_{vol} + mor_{vol}$$

```{r}
lab4mai$tot_vol <-lab4mai$stand_vol + lab4mai$harv_vol + lab4mai$mor_vol
```

We subset the data according to species

```{r}
birch <- subset(lab4mai, site==6)
spruce <- subset(lab4mai, site==1)
```

**A little exploration**

```{r}
par(mar = c(5, 4, 4, 4) + 0.5)

plot(birch$age, birch$stdens, type = "l",
     ylim = c(0,2500),
     col = 'red',
     xlab = substitute(paste(bold('age'))),
     ylab = substitute(paste(bold('Stand density'))),
     main = 'Stand density and height relationship')
points(birch$age, birch$stdens,
         col = 'blue',
       pch = 19)
par(new = TRUE)
plot(spruce$age, spruce$stdens, type = "l",
     ylim = c(0,2500),
     col = 'black',
     axes = FALSE,
     xlab = "",
     ylab = "")
points(spruce$age, spruce$stdens,
         col = 'purple',
       pch = 16)
axis(side = 4, at = pretty(range(spruce$stdens)))
mtext (substitute(paste(bold('Stand density'))), side = 4, line = 3)
legend('topright', legend = c('birch', 'spruce'),
       pch = c(19,16),
       col = c('blue', 'purple'))
```

The plot above from our little exploration gives us an idea of the number of thinnings that have occurred for both species. Birch was thinned once while Spruce was thinned thrice.

## Total Yield Estimation

To estimate the total yield, we evaluate the cumulative of all the volume removed from the forest then add it to the standing volume.

```{r}
# cumulative of birch
birch$sum_harv <- cumsum(birch$harv_vol)
birch$sum_mor <- cumsum(birch$mor_vol)

# total yield or volume for birch
birch$sumvol <- birch$sum_harv + birch$sum_mor + birch$stand_vol

# cumulative ofspruce
spruce$sum_harv <- cumsum(spruce$harv_vol)
spruce$sum_mor <- cumsum(spruce$mor_vol)



# total yield or volume for spruce
spruce$sumvol <- spruce$sum_harv + spruce$sum_mor + spruce$stand_vol

```

\*\*Visualizing the result and comparing the respective standing volume between the two species)

```{r}
par (mar = c(5,4,4,4) + 0.3)
plot(birch$age, birch$stand_vol,
     col = 'red',
     xlab = substitute(paste(bold('Age (years)'))),
     ylab = substitute(paste(bold('Volume (m3)'))),
     main = 'Stand Volume Development',
     pch = 19,
     cex = 0.5,
     type = 'b',
     xlim = c(0,140),
     ylim = c(0,1000))
points (birch$age,birch$sumvol,
          pch = 19,
         col ='red',
        cex = 0.7,
        type = 'b')
par (new = TRUE)
plot(spruce$age, spruce$sumvol,
     col = 'purple',
     type = 'b',
     cex = 0.7,
     pch = 16,
     xlab = "",
     ylab = "",
     axes = FALSE)
points(spruce$age,spruce$stand_vol,
       col ='purple',
       pch = 16,
       cex = 0.5,
       type = 'b')
axis (side = 4,
      at = pretty(range(spruce$sumvol)))
mtext(substitute(paste(bold('Volume (m3)'))),
      side = 4,
      line = 3)
legend("topleft", 
       legend = c('birch', 'spruce'),
       pch = c(19,16),
       col = c('red', 'purple'))
legend ("bottomright",
        legend = c('standing volume', 'total yield'),
        pch = c(19),
        cex = c(0.5, 1))
```

## CAI and MaI

**birch**

```{r}
birch$last_vol <- shift(birch$stand_vol) ## this brings the previous measurement forward to the current row

## CAI
birch$cai <- (birch$stand_vol + birch$harv_vol + 
  birch$mor_vol - birch$last_vol)/5

## MAI
birch$mai <- birch$sumvol/birch$age
```

**spruce**

```{r}
spruce$last_vol <- shift(spruce$stand_vol) # Last measurement brought to the current row

## CAI
spruce$cai <- (spruce$stand_vol + spruce$harv_vol + 
                spruce$mor_vol - spruce$last_vol)/5

## Spruce MAI
spruce$mai <- spruce$sumvol/spruce$age
```

**Birch CAI and MAI**

```{r}
plot(birch$age, birch$mai,
     type = 'b',
     pch = 18,
     col = 'red',
     ylim = c(0,15),
     xlim = c(0, 140),
     main = 'MAI and CAI',
     ylab = substitute(paste(bold('Increment (m3 ha-1 yr-1)'))),
     xlab = substitute(paste(bold('age (years)'))))
points(birch$age, birch$cai,
        type = 'b',
        pch = 20,
        col = 'green')
legend("topleft",
         legend = c("MAI", "CAI"),
         pch = c(18, 20),
         col = c('red', 'green'))
```

**Spruce CAI and MAI**

```{r}
plot(spruce$age, spruce$mai,
     type = 'b',
     pch = 18,
     col = 'red',
     ylim = c(0,20),
     xlim = c(0, 140),
     main = 'MAI and CAI',
     ylab = substitute(paste(bold('Increment (m3 ha-1 yr-1)'))),
     xlab = substitute(paste(bold('age (years)'))))
points(spruce$age, spruce$cai,
         type = 'b',
         pch = 20,
         col = 'green')
legend("topleft",
         legend = c("MAI", "CAI"),
         pch = c(18, 20),
         col = c('red', 'green'))
```

## Correcting Thinning Age

Usually the year of harvest or thinning is usually having two volumes and time. The first is the volume before we harvest and the second is the volume we harvest. They are usually the same, but time of harvest differs by days, or months. Since forestry is a business that involves calculating stand volume on some yearly period. It is usually costly and unprofitable to carry out inventory every year, thus, we do it between certain periods, 5 to 10 years, while we still monitor the stand between such period. Now we adjust the year of thinning and standing volume to show the age before harvest.

```{r}
# Birch
birch_thinned <- subset(birch, harv_vol>0)
birch_thinned$stand_vol <- birch_thinned$stand_vol + birch_thinned$harv_vol
birch_thinned$age <- birch_thinned$age  - 0.01

# Spruce
spruce_thinned <- subset(spruce, harv_vol >0)
spruce_thinned$stand_vol <- spruce_thinned$stand_vol + spruce_thinned$harv_vol
spruce_thinned$age <- spruce_thinned$age  - 0.01

head(birch_thinned)
head(spruce_thinned)
```

Since this data is obtained, we can merge the table to the previous to have the corrected thinning age

```{r}
# Birch
birch_new <- merge(birch, birch_thinned, all = T)

# Spruce
spruce_new <- merge(spruce, spruce_thinned, all = T)
```

We can now visualize the new stand development

```{r}
par (mar = c(5,4,4,4) + 0.2)

plot(birch_new$age, birch_new$stand_vol,
     col = 'red',
     xlab = substitute(paste(bold('Age (years)'))),
     ylab = substitute(paste(bold('Volume (m3)'))),
     main = 'Stand Volume Development',
     pch = 19,
     type = 'b',
     xlim = c(0,140),
     ylim = c(0,1000),
     cex = 0.5) 
points (birch_new$age,birch_new$sumvol,
          pch = 19,
         col ='red',
        type = 'b',
        cex = 0.7) 
par(new = TRUE)
plot(spruce_new$age, spruce_new$sumvol,
     col = 'green',
     type = 'b',
     axes = FALSE,
     pch = 17,
     xlab = "",
     ylab = "",
     cex = 0.7)
points(spruce_new$age,spruce_new$stand_vol,
       col ='green',
       pch = 17,
       type = 'b',
       cex = 0.5) 
axis (side = 4, 
      at = pretty(range(spruce_new$sumvol)))
mtext(substitute(paste(bold('Volume (m3)'))),
                       side = 4,
                       line = 3)
legend("topleft", 
       legend = c('birch', 'spruce'),
       pch = c(19,17),
       col = c('red', 'green'))
legend ("bottomright",
        legend = c('standing volume', 'total yield'),
        pch = c(17),
        cex = c(0.5, 1))
```

## How many Thinnings

From the figure above we can see that spruce was thinned 3 times while birch was thinned once.

## Heavy or Light Thinning(s)?

The definition of what is heavy or not is something that varies depending on the parameter used for thinning viz basal area or stand density, but for simplicity, stand density will be the parameter used to determine the thinning intensity. Based on the stand density or number of trees removed from the stand, thinning ≤ 25% is regarded as light thinning, 50% regarded as moderate, and > 50% is regarded as heavy thinning (Gonçalves, 2021). Using thinning intensity or degree formula provided by Gonçalves 2021 $$RN = Nrem/Nt $$ Where Nrem = Number of trees removed Nt = Total number of trees

**For spruce**

| Age       | Stand_density | Thinning intensity | Light or Heavy? |
|-----------|---------------|--------------------|-----------------|
| 35 and 40 | 1890.1-842.8  | 55.4%              | Heavy           |
| 50 and 55 | 816.2/517.6   | 36.6%              | Moderate        |
| 70 and 75 | 565.9 - 340.9 | 39.8%              | Moderate        |

: Thinning for Spruce

**For Birch**

| Age   | Stand_density  | Thinning intensity | Light or Heavy? |
|-------|----------------|--------------------|-----------------|
| 70-75 | 1465.7 - 785.5 | 46.4%              | Moderate        |

: Thinning for Birch

* * * * * *

# Poplar Cutting Experiment - Exp V

## Question:

    -   Investigate if the volume of 12 weeks seedlings is related to the initial cutting weight.

    -   Make a regression of height and dbh,then determine if dbh can be used to predict height if height data is missing.

**Importing data**
```{r}

# Importing data
pop2 <- read.table("https://raw.githubusercontent.com/xrander/Slu_experiment/master/Data/Lab%205/pop2.txt",
           header = T, sep = '\t', dec = '.', na.strings = 'NA', strip.white = T)
poplar <- read.table("https://raw.githubusercontent.com/xrander/Slu_experiment/master/Data/Lab%205/poplar.txt",
                     header = T, sep = '\t', dec = '.', na.strings = 'NA', strip.white = T)
spruce2 <- read.table("https://raw.githubusercontent.com/xrander/Slu_experiment/master/Data/Lab%205/spruce.txt",
                      header = T, sep = '\t', dec = '.', na.strings = 'NA', strip.white = T)
```

**Data description**
***pop2 and poplar***
  
- block:1-5 

- cutw:total dryweight biomass (g)

- height:aboveground height (mm)

- dia:root collar diameter (mm)

- clone: A,B,C

- fert: 1=fertilized, 3= control

***Spruce****
The data is just a short list of sampled saplings of Norway spruce with dbh (mm) and height (dm). The data is taken from a short interval of heights and the relation between height and diameter is still linear (compared to the range that you usually have in a stand). That is why, we are interested in testing whether we could use a linear model to fit a regression line of the relationship of height and dbh.

  
** Little exploration**
```{r}
str(pop2)
summary(pop2)
plot (pop2$dia)
```

There is a wrong diameter value that is far from the average mean.Also, we have missing value in the height variable.

#### Dealing with Missing Data
```{r}
pop2[is.na(pop2$height), ]
## This shows we have one Na Value and it is in row 109

pop2[complete.cases(pop2), ] ## can be written as 
pop2[complete.cases(pop2$height), ]## still the same.
## This shows only the complete cases or rows without missing values
```

Let's say we found the value where we recorded the data we can simply replace it using the chunk below
```{r}
pop2[is.na(pop$height), ] <- 331
```
Now we run the summary again to see if there's a missing data

```{r eval=FALSE, results='hide'}
is.na(pop2)
```
The result is false all through

#### Dealing with Outliers
With outliers we need to careful as they can sometime be true and not errors.

**Identifying the outlier**
```{r}
summary(pop2)
```

We check the mean, quantiles, min, and max value to see where the outlier exist. dia is having an outlier
```{r}
pop2[(pop2$dia> 5),]
```

row 98 is having the data with an outlier. On checking the original data written from the field, the result was 38
```{r}
## changing data
pop2$dia <- ifelse(pop2$dia > 38, 3.9, pop2$dia)
```

### Fitting the Linear Model
```{r}
plot(poplar$cutw, poplar$vol)

# Linear model
lmpop <-lm(vol~cutw, data = poplar)

anova (lmpop)
```
**checking the distribution of the data.**
```{r}
hist(lmpop$residuals)
```

Checking for homoscedactisity, i.e, the assumption for similar variance for a group being compared.

```{r}
plot(lmpop$fitted.values, lmpop$residuals,
     xlab = 'Fitted Values',
     ylab = 'Residuals')
abline(c(0,0), col = 2)
```

Making a **qqplot** (quantile-quantile plot) to check for normal distribution
```{r}
qqnorm(lmpop$residuals)
qqline(lmpop$residuals, col = 'red')
```


Now we can use the predicted values of the linear model as a function to estimat4e a value when we have the cutting weight available. Let's use the function which we have
To get the value for the function, we extract the intercept and slope
```{r}
##intercept
intcpt <- coef(lmpop)[1]

## slope
slp <- coef(lmpop)[2]
```

##### Creating a simulated value for cutting weights
```{r}
simul.cutw <- c(0.1, 2, 4,5,6, 9, 10, 14, 16)

### Applying the model
simul.vol <- intcpt + (slp * simul.cutw)

###
simul <- data.frame(simul.cutw, simul.vol)
```

Plotting the data the relationship
```{r}
plot(simul$simul.cutw, simul$simul.vol,
     pch = 16,
     col = 'red',
     xlab = 'cutting width',
     ylab = 'volume',
     main = 'Cutting width vs volume relationship in Poplar')
lines(simul$simul.cutw, simul$simul.vol,
      lwd = 1.1,
      col = 'blue')
points(poplar$cutw, poplar$vol,
       pch = 2,
       cex = 0.6,
       col = 'black')
```
## SPruce Stand
**Data exploration**
```{r}
summary(spruce2)
## quick visualization
plot(spruce2$height, spruce2$dbh)
```
Fittiing linear model
```{r}
lmspruce <- lm(spruce2$height~spruce2$dbh)

anova(lmspruce)
```

Checking the distribution of the residuals
```{r}
hist(lmspruce$residuals)
```

Checking for homoscedactisity,i.e the assumption for similar variance for a group being compared.
```{r}
plot(lmspruce$fitted.values, lmspruce$residuals,
     xlab = 'fitted values',
     ylab = 'residuals')
abline(c(0,0), col = 'red')
```

**QQplot**
```{r}
qqnorm(lmspruce$residuals)
qqline(lmspruce$residuals, col = 'green')

```
##### Testing the model
```{r}
int_spr <-coef(lmspruce)[1]
slp_spr <- coef(lmspruce)[2]

### Generating random numbers
sprce_dbh = sample(5:50, replace = TRUE)
sprce_height = int_spr + (slp_spr * sprce_dbh)
sprce <- data.frame(sprce_height, sprce_dbh)

```

```{r}
plot(sprce$sprce_height, sprce_dbh,
     col = 'red')
lines(sprce$sprce_height, sprce_dbh,
      col = 'black')
points(spruce2$height, spruce2$dbh)
```

* * * * * * * * * * ' 

# Fertilizer Regime Experiment - Exp VI
In this experiment, a young Norway Spruce stands was established with 5 blocks with randomly distributed treatments in 0.1 ha plots. The treatments are with 3 different intensities in fertilization

- F1:   Fertilized every year

- F2:   Fertilized every second year

- F3:   Fertilized every third year

-  C:   Control without Fertilzation.

The amount of nutrients over time was calculated to be more or less the same in F1 F2 and F3.

The experiment was measured initially in revision 1 (1972) and there after in several revisions, but the important revisions are the focus here which is an interval of 5 years period  (rev 1, 4, 5, and 6).

The volume (m3/ha) and CAI (m3 ha-1yr-1) were calculated for every treatment plot in all blocks.

##Questions

    -   is there a significant effect of treatment compared to control?
    
    -   Do you find a significant difference in between the different treatments, meaning fertilization intensity
    
    -   Do you find any different effect of treatment early on in the experiment compared to later revisions


**Importing the data**
```{r}
expfert <- read.table('https://raw.githubusercontent.com/xrander/SLU-Plantation-Experimentation/master/Data/Lab6/expfert.txt',
           header = T,
           sep = '\t',
           na.strings = 'NA',
           dec = '.',
           strip.white = T)


```
**A Little Data Exploration**
```{r results='hide', message=FALSE,warning=FALSE}

str(expfert)
summary(expfert)
```
**To check the numbe rof replications we have in this experiment**
```{r}
ftable(expfert$block, expfert$treatment, expfert$revision)

```
We have 4 revisions and 5 replicates

We can check a quick visual on how the experiment have been measured repeatedly overtime (revisions)
```{r}
xyplot(age~revision|block, data = expfert,
       col = 1,
       pch = 16,
       type= c('p','l'), # to change the plot type, an alternative is using type = 'b'
       strip = strip.custom(bg = 'red'))
```

**Visualizing CAI changes over the revisions**
```{r}
xyplot(CAI~factor(revision)|block,
       groups=treatment,data=expfert,
       par.settings=simpleTheme(col=c(1,2,3,4),pch=c(16,1,2,3)), #adding settings for symbology
       auto.key=list(corner = c(0.02, 0.94),border="black",cex=0.5,points=T))
```
```{r}
xyplot(volume~domheight | treatment,
       group = block,
       data = expfert,
       type = 'b',
       xlab = 'Dominant Height',
       auto.key = list(corner = c(0.02,0.8), border = 'blue', cex = 0.7))
```
## Volume and CAI at the different blocks for the different treatments
### Volume

```{r}
barchart(volume~treatment|block, data = expfert,
         subset = revision == 1,
         main = 'Revision 1',
         ylab = substitute(paste(bold('Volume'))),
         xlab = substitute(paste(bold('Treatment'))))
```

```{r}
barchart(volume~treatment|block, data = expfert,
         subset = revision == 4,
         main = 'Revision 4',
         col = 'purple',
         ylab = substitute(paste(bold('Volume'))),
         xlab = substitute(paste(bold('Treatment'))))
```
```{r}
barchart(volume~treatment|block, data = expfert,
         subset = revision == 5,
         main = 'Revision 5',
         col = 'blue',
         ylab = substitute(paste(bold('Volume'))),
         xlab = substitute(paste(bold('Treatment'))))
```
```{r}
barchart(volume~treatment|block, data = expfert,
         subset = revision == 6,
         main = 'Revision 6',
         col = 'red',
         ylab = substitute(paste(bold('Volume'))),
         xlab = substitute(paste(bold('Treatment'))))
```


### CAI
```{r}
barchart(CAI~treatment | block, data = expfert,
         subset = revision == 4,
         col = 'purple',
         main = 'Revision 4',
         xlab = substitute(paste(bold('treatment'))),
         ylab = substitute(paste(bold('CAI'))))
```

```{r}
barchart(CAI~treatment|block, data = expfert,
         subset = revision == 5,
         col = 'blue',
         main = 'Revision 5',
         xlab = substitute(paste(bold('treatment'))),
         ylab = substitute(paste(bold('CAI'))))
```

```{r}
barchart(CAI~treatment|block, data = expfert,
         subset = revision == 6,
         col = 'red',
         main = 'Revision 6',
         xlab = substitute(paste(bold('treatment'))),
         ylab = substitute(paste(bold('CAI'))))
```
## Dominant Height across treatments

```{r}
bwplot(domheight~treatment, subset=revision==1, data = expfert,
       xlab = substitute(paste(bold('treatment'))),
       ylab = substitute(paste(bold('dominant height (m)'))),
       main = 'dominant height across treatments for revision 1')
```

```{r}
bwplot(domheight~treatment, subset=revision==4, data = expfert,
       xlab = substitute(paste(bold('treatment'))),
       ylab = substitute(paste(bold('dominant height (m)'))),
       main = 'dominant height across treatments for revision 4')
```

```{r}
bwplot(domheight~treatment, subset=revision==5, data = expfert,
       xlab = substitute(paste(bold('treatment'))),
       ylab = substitute(paste(bold('dominant height (m)'))),
       main = 'dominant height across treatments for revision 5')
```

```{r}
bwplot(domheight~treatment, subset=revision==6, data = expfert,
       xlab = substitute(paste(bold('treatment'))),
       ylab = substitute(paste(bold('dominant height (m)'))),
       main = 'dominant height across treatments for revision 6')
```
## Analysis of Variance to see the effect of the treatments on the volume produced
### Revision of 4
```{r}
M.vol <- lm(volume~block+treatment, 
            data = expfert[expfert$revision==4,])
M.vol
anova(M.vol)
```

#### Posthoc test using Tukeyhsd
```{r}
T.vol <- TukeyC(x = M.vol, which = 'treatment')
summary(T.vol)
```


**Checking for patterns in the residuals with a residual plot**
```{r}
plot(M.vol$fitted.values, M.vol$residuals,
     xlab = 'Fitted Values',
     ylab = 'Residuals')
abline (c(0,0), col = 2)
```
**Getting more information using base r plot function**

```{r}
plot(M.vol)
```

### Revision 5
```{r}
M.vol5 <- lm(volume~block+treatment,
             data = expfert[expfert$revision == 5,])
anova(M.vol5)
```

The anova test shows a significant in the treatment effect on volume production.
#### Post hoc test using Tukeys HSD
```{r}
T.vol5 <- TukeyC(x = M.vol5, which = 'treatment')

summary(T.vol5)
```

**Checking for patterns in the residuals with a residual plot**
```{r}
plot(M.vol5$fitted.values, M.vol5$residuals,
     xlab ='fitted values',
     ylab = 'residuals')
abline(c(0,0), col = 'black')
```

### Revision 6
```{r}
M.vol6 <- lm(volume~block+treatment,
             data = expfert[expfert$revision == 6,])
anova(M.vol6)

```

#### Posthoc test (Tukey HSD)
```{r}
T.vol6 <- TukeyC(x = M.vol6, which = 'treatment')

summary(T.vol6)
```
**Checking for patterns in the residuals with a residual plot**
```{r}
plot(M.vol6$fitted.values, M.vol6$residuals,
     xlab ='fitted values',
     ylab = 'residuals')
abline(c(0,0), col = 'black')

```

## Analysis of Variance to see the effect of the treatments on the current annual increment
### Revision 4
```{r}
m.cai4 <- lm(CAI~block+treatment,
             data = expfert[expfert$revision == 4,])
anova(m.cai4)
```

#### Posthoc test for ranking
```{r}
t.cai4 <- TukeyC(x = m.cai4, which = 'treatment')

summary(t.cai4)
```


**Checking for patterns in the residuals with a residual plot**
```{r}
plot(m.cai4$fitted.values, m.cai4$residuals,
     xlab ='fitted values',
     ylab = 'residuals')
abline(c(0,0), col = 'black')
```

### Revision 5

```{r}
m.cai5 <- lm(CAI~block+treatment,
            data = expfert[expfert$revision == 5,])
anova(m.cai5)
```
#### Posthoc test
```{r}
t.cai5 <- TukeyC(x = m.cai4, which = 'treatment')

summary(t.cai5)
```

**Checking for patterns in the residuals with a residual plot**
```{r}
plot(m.cai5$fitted.values, m.cai5$residuals,
     xlab ='fitted values',
     ylab = 'residuals')
abline(c(0,0), col = 'black')
```

### Revision 6
```{r}
m.cai6 <- lm(CAI~block+treatment,
            data = expfert[expfert$revision == 6,])
anova(m.cai6)
```

#### Post hoc test
```{r}
t.cai6 <- TukeyC(x = m.cai4, which = 'treatment')

summary(t.cai6)
```

**Checking for patterns in the residuals with a residual plot**
```{r}
plot(m.cai6$fitted.values, m.cai6$residuals,
     xlab ='fitted values',
     ylab = 'residuals')
abline(c(0,0), col = 'black')
```


# Fertilization Experiment with Poplar - VI (2)
**Importing the data**
```{r}
poptr<- read.table('https://raw.githubusercontent.com/xrander/Slu_experiment/master/Data/Lab6/poplartreatment.txt',
           header = T, sep = '\t',
           dec = '.', na.strings = 'NA',
           strip.white = T)
```

This is an extract from the seedling experiment earlier. We'll try to see if there's a significant difference between fertilized and unfertilized seedlings.
**Data Exploration**
```{r}
str(poptr)
```

```{r}
bwplot(volume~treatment, data = poptr,
       xlab = substitute(paste(bold('treatment'))),
       ylab = substitute(paste(bold('volume (m3)'))),
       main = 'Volume distribution for the different treatments')
```
```{r}
bwplot(cutw ~treatment,
       data = poptr,
       xlab = substitute(paste(bold('treatment'))),
       ylab = substitute(paste(bold('colar width (mm)'))),
       main = 'collar width of the different treatments')
```
```{r}
xyplot(volume~cutw, data = poptr,
       group = treatment,
       xlab = substitute(paste(bold('Colar Width (mm)'))),
       ylab = substitute(paste(bold('Volume(m3)'))),
       main = 'collar_width vs volume')
```

## Analysis of Variance
Now we test to see if there are no effect of the treatment on the volume
```{r}
lm(volume~treatment, data = poptr)
```

# Mean Test of Regeneration - Exp (VII) (1)
The stem density inventory of regeneration is made from clear cuts labeled A,B,C, and D. Two species were regenerated, Norway Spruce and Birch were the species measured. Norway spruce was planted and Birch was naturally regenerated. The same plots were sed for the clearcuts but the number of plots varied between sites. The regenerations are already 6 years of age.
![](https://silvlib.cfans.umn.edu/sites/silvlib.cfans.umn.edu/files/styles/cover_type_small/public/figure_3_1.jpg?itok=J1FF9IiL)

## Question
 The aim of this session is to compare two means, individual species stem density mean vs mean value of all inventory plots from all sites.
 
```{r}
regen <- read.table('https://raw.githubusercontent.com/xrander/Slu_experiment/master/Data/Lab%207/regenerationsprucebirch.txt',
           header = T, dec = '.',
           strip.white = T,
           sep = '\t',
           na.strings = 'NA')
```
**Data Description**
site = site_id A, B, C or D
plot = plot id 1 - 7
species = spruce or birch
density = stems per ha

**Data  Exploration**
```{r}
str(regen)
```
changing plot to factor data type
```{r}
regen$plot <- as.factor(regen$plot)
```

```{r}
str(regen)
```
```{R}
summary(regen)
```

From the summary we can notice that we have unequal replications of the plots in the sites

```{r}
xyplot(density~plot, data = regen,
       group = species,
       main = 'Distribution of regeneration across the plots',
       ylab = substitute(paste(bold('No of Stems'))),
       xlab = substitute(paste(bold('plot'))),
       auto.key = list(corner = c(0.9,0.9), border = 'blue', cex = 0.7))
```

**getting a view of the experiment design**
```{r}
table(regen$site, regen$plot)
```

**Comparing mean**
```{r}
mean_1 <- summaryBy(density~species, data = regen, FUN = c(mean,sd, length))
mean_1
```
This is the general mean without regards for the differences in the site replications.

```{r}
sitemean <- summaryBy(density~species + site, data = regen, na.rm = T, keep.names = T, FUN = mean)

sitemean
```
```{r}
mean_2 <- summaryBy(density~species, data = sitemean,
        FUN = c(mean, sd, length))
mean_2
```


**Estimating the standard error**

```{r}
mean_1$st_err <- mean_1$density.sd/sqrt(mean_1$density.length)
mean_2$str_err <- mean_2$density.sd/sqrt(mean_2$density.length)
```

# LodgePole Pine Experiment (VII) (2)
This experiment is a soil scarification experiment with Lodegepole Pine in Västerbotten, Sweden. The treatments were either planting after soil scarification using deep plowing (deep), or planting without any site preparation (control). The size of the treatment plots were 30*30 m and the experiment was replicated in 4 blokcs. The plantation was made in 1988 and the experiment was remeasured after several years, to 2012, when all trees in the treatment plots were cross calipered at dbh (mm).

## Questions
For this data,
I'll be exploring the data and then calculating the basal area/ha and stem density/ha for every block and treatment. I seek to answer the following:

    - What effect have a radical soil scarification method such as deep plowing on:
        -- survival and
        
        -- growth of lodgepole pine on the site

In other words: Is there a significant effect of treatment  if we test for:


-   stem density and

-   basal area.

**Importing the data**
```{r}
L_pine <- read.table('https://raw.githubusercontent.com/xrander/Slu_experiment/master/Data/Lab%207/deepcult_lodgepolepine.txt',
           header = T,
           sep = '\t',
           na.strings = 'NA',
           dec = '.',
           strip.white = T)
```




# Mixed Forest Experiment
This an experiment on the site 8556.Is there a significant difference in net and gross production between the monoculture and  mixtures? Does the Norway spruce trees in the treatments differ in mean diameter? This is one of the common questions in Southern Sweden.
Many forests in southern Sweden is managed as mixtures of Norway spruce and birch. This is a 38- year old stand where an experiment has been established in the precommercial thinning stage. The purpose of the experiment has been, and is, to evaluate this different  forest types over time, where one of the species (birch) is fast growing in the establishment  phase and the other tree species (Norway spruce) is expected to catch up in growth in the more mature phase. One of the questions for forest owners that want to use the mixture of Norway spruce and birch is how to manage the difference in growth rhythm and how to keep both species during the full rotation of the stand.

**Experimental design**
The experiment is organized in three blocks and the treatments were randomly assigned to  plots of about 0.1 ha each, one treatment plot in each block.

-   Monoculture: 100 % Norway spruce (NS)

-   Admixture: 80 % Norway spruce and 20 % birch (NS80)

-   Mixed: 50 % Norway spruce and  50 % birch (NS50)

The experiment has been revised 5 times (including thinning 3 times) after the beginning of the experiment. In every thinning the mixture percentage in basal area, has been retained. In the data-set that I will be working with, I have a sample plot data at the time of  second 
revision, which is the first remeasurement after the first thinning. The initial age at revision 1 and treatments, varies for the sites (between 32 and 48 years) and so do the time between revision 1 and 2 (7-15 years). 

**Importing the data**
```{r}
mix <- read.table('https://raw.githubusercontent.com/xrander/Slu_experiment/master/Data/Last%20straw/TaskE_mix.txt',
           header = T,sep = '\t',
           na.strings = 'NA',
           strip.white = T,
           dec = '.')
mix
```

**Data Description**
The data-set includes data from revision 2:

-   Block: block

-   Plotno: plot number

-   Treatment: treatment code (same as listed above)

-   Standingvol:  standing volume per hectare (m3 ha-1 )

-   Harvestvol: harvested volume in thinnings and measured dead volume (m3 ha-1 )

-   Paiha: Measured periodic annual increment at latest revision (m3 ha-1  year-1)

-   Dbh: Mean dbh of Norway spruce at latest revision, age 38 (cm)

**Questions**
-   What is total volume production at the last revision?

-   Can you find any statistical differences between the selected treatments at this time, in 
terms of total volume production, PAI, dbh?

-   Show with some figures that you understand the data and your results.The data-set includes data from revision 2:

**A Little Exploration**
```{r}
str(mix)
summary(mix)
```
Changing the data type of plot no, block and treatment
```{r}
mix$plotno <- as.factor(mix$plotno)
mix$block <- as.factor(mix$block)
mix$treatment <- as.factor(mix$treatment)
```

## Total Volume Produced
```{r}
mix$total_vol <- mix$standingvol + mix$harvestvol + mix$dbh
```
**VOlume Produced according to the treatments**

```{r}
Total_vol_mix <- summaryBy(total_vol~treatment, data = mix, FUN = sum)
Total_vol_mix
```

**Visualizing the result**
```{r}
mixb <- barplot(total_vol.sum~treatment,
         data = Total_vol_mix,
         ylab = substitute(paste(bold('Total Volume (m3)'))),
         col = c(3:5),
         xlab = substitute(paste(bold('Treatments'))),
         main = 'Total Volume produced by each treatments',
         ylim = c(0, 1600))
text (x = mixb, y = Total_vol_mix$total_vol.sum, label = Total_vol_mix$total_vol.sum, pos = 3, cex = 0.45)
```
```{r}
barchart(total_vol~treatment | block,
         data = mix,
         ylab = substitute(paste(bold('Total Volume (m3)'))),
         group = block,
         xlab = substitute(paste(bold('Treatments'))),
         main = 'Total Volume produced by each treatments at the different Blocks',
         box.ratio = 2,)
```


```{r}
#Experiment design
ftable(mix$block, mix$treatment)
```

## Analysis of Variance
```{r}
## pai
mix_paiha <- lm(paiha ~ block+treatment , data = mix)

##tot_vol
mix_tvol <- lm(total_vol ~ block+treatment , data = mix)

##dbh
mix_dbh <- lm(dbh~block+treatment, data = mix)
```

```{r}
## tot_vol
anova(mix_tvol)

##dbh
anova(mix_dbh)

##pai
anova(mix_paiha)
```
### Post Hoc Test
```{r}
summary(TukeyC(mix_paiha, which = 'treatment'))
```
```{r}
summary(TukeyC(mix_dbh, which = 'treatment'))
```
[Growth Experiment](growth_experiment,md)
[Spacing Experiment](spacing_experiment.md)
[Thinning Exeperiment](Thinning_experiment.md)

[Back to home page](https://xrander.github.io)